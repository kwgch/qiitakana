- model_class = Post
= simple_nested_form_for [current_user, @post]  do |f|

  %p
    = f.text_field :title, label: false, placeholder: 'タイトル', class: "string optional form-control"

  .form-inline
    = f.fields_for :tags do |t|
      .input-group{style: 'padding-bottom: 5px'}
        = t.text_field :name, label: false, class: "col-xs-4 string optional form-control", placeholder: 'タグ'
        .input-group-addon
          = t.link_to_remove fa_icon('remove')
    = f.link_to_add fa_icon('plus-circle', text: 'タグ追加', right: true), :tags

  %br
  %p
    = f.text_area :markdown, label: false, placeholder: 'Markdown',  rows: 10, class: "text optional form-control"
    .bs-example= @post.body.nil? ? 'preview' : @post.body.html_safe

  %p.text-right
    = f.button :submit, class: 'btn-primary'
    = link_to t('.cancel', default: t('helpers.links.cancel')), user_posts_path, class: 'btn btn-default'

:javascript
  $(function() {
    return $("textarea#post_markdown").change(function() {
      $.ajax({
        url: "preview",
        type: "POST",
        data: {
          markdown: $("textarea#post_markdown").val()
        },
        dataType: "html",
        success: function(data) {
          $(".bs-example").html(data);
        },
        error: function(data) {
          alert("error");
        }
      });
    });
  });