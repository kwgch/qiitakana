- model_class = Post
= simple_nested_form_for [current_user, @post]  do |f|

  %p
    = f.text_field :title, label: false, placeholder: 'タイトル', class: "string optional form-control"

  .form-inline
    = f.fields_for :tags do |t|
      .input-group{style: 'padding-bottom: 5px'}
        = t.text_field :name, label: false, class: "col-xs-4 string optional form-control", placeholder: 'タグ'
        .input-group-addon
          = t.link_to_remove fa_icon('remove')
    = f.link_to_add fa_icon('plus-circle', text: 'タグ追加', right: true), :tags

  %br
  %p
    = f.text_area :markdown, label: false, placeholder: 'Markdown',  rows: 10, class: "text optional form-control"
    .bs-example= @post.body.nil? ? 'preview' : @post.body.html_safe

  .text-right
    .btn-group#publish{style: @post.published? ? '' : 'display:none;'}
      = f.button :submit, class: 'btn-primary'
      %button.btn.dropdown-toggle{'type'=>'button', 'data-toggle'=>'dropdown'}
        %span.caret
      %ul.dropdown-menu{role: 'menu', style: 'text-align: left;'}
        %li.btn.btn-success(onclick='selectDraft();')
          一時保存
    .btn-group#draft{style: @post.drafted? ? '' : 'display:none;'}
      = f.button :submit, '一時保存', class: 'btn-success', name: 'post[draft]'
      %button.btn.dropdown-toggle{'type'=>'button', 'data-toggle'=>'dropdown'}
        %span.caret
      %ul.dropdown-menu{role: 'menu', style: 'text-align: left;'}
        %li.btn.btn-primary(onclick='selectPublish();')
          更新する
        %li.btn.btn-primary(onclick='selectLimit();')
          限定共有投稿
    .btn-group#limit{style: @post.limited? ? '' : 'display:none;'}
      = f.button :submit, '限定共有投稿', class: 'btn-success', name: 'post[limit]'
      %button.btn.dropdown-toggle{'type'=>'button', 'data-toggle'=>'dropdown'}
        %span.caret
      %ul.dropdown-menu{role: 'menu', style: 'text-align: left;'}
        %li.btn.btn-primary(onclick='selectPublish();')
          更新する
        %li.btn.btn-success(onclick='selectDraft();')
          一時保存

    = link_to t('.cancel', default: t('helpers.links.cancel')), user_posts_path, class: 'btn btn-default'

:javascript
  function selectPublish(){
    showBtn(true, false, false);
  }
  function selectDraft(){
    showBtn(false, true, false);
  }
  function selectLimit(){
    showBtn(false, false, true);
  }
  function showBtn(publish, draft, limit){
    publish ? $("#publish").show() : $("#publish").hide();
    draft ? $("#draft").show() : $("#draft").hide();
    limit ? $("#limit").show() : $("#limit").hide();
  }
  $(function() {
    return $("textarea#post_markdown").change(function() {
      $.ajax({
        url: "/preview",
        type: "POST",
        data: {
          markdown: $("textarea#post_markdown").val()
        },
        dataType: "html",
        success: function(data) {
          $(".bs-example").html(data);
        },
        error: function(data) {
          alert("error");
        }
      });
    });
  });